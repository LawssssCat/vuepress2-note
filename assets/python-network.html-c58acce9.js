import{_ as p,r as o,o as c,c as i,a as s,b as n,d as e,e as a}from"./app-04e6f892.js";const l={},u=a(`<h2 id="套接字-socket" tabindex="-1"><a class="header-anchor" href="#套接字-socket" aria-hidden="true">#</a> 套接字（socket）</h2><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> socket
<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys

<span class="token keyword">def</span> <span class="token function">retBanner</span><span class="token punctuation">(</span>ip<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        socket<span class="token punctuation">.</span>setdefaulttimeout<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span>
        s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>ip<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span>
        banner <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span> <span class="token comment"># 读取套接字中接下来的 1024B 数据</span>
        <span class="token keyword">return</span> banner
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span>
lines <span class="token operator">=</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;3Com 3CDaemon FTP Server Version 2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;Ability Server 2.34&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;CCProxy Telnet Service Ready&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;ESMTP TABS Mail Server for Windows NT&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;FreeFloat Ftp Server (Version 1.00),&quot;</span>
    <span class="token string">&quot;IMAP4rev1 MDaemon 9.6.4 ready&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;MailEnable Service, Version: 0-1.54&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;NetDecision-HTTP-Server 1.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;PSO Proxy 0.9&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;SAMBAR&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;Sami FTP Server 2.0.2&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;Spipe 1.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;TelSrv 1.5&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;WDaemon 6.8.5&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;WinGate 6.1.1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;Xitami&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;YahooPOPs! Simple Mail Transfer Service Ready&quot;</span>
<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">checkVulns</span><span class="token punctuation">(</span>banner<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
        <span class="token keyword">if</span> line <span class="token keyword">in</span> banner<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;[+] Server is vulnerable: {}&#39;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>banner<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    portList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token number">443</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">147</span><span class="token punctuation">,</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        ip <span class="token operator">=</span> <span class="token string">&#39;192.168.95.{}&#39;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">for</span> port <span class="token keyword">in</span> portList<span class="token punctuation">:</span>
            banner <span class="token operator">=</span> retBanner<span class="token punctuation">(</span>ip<span class="token punctuation">,</span> port<span class="token punctuation">)</span>
            <span class="token keyword">if</span> banner<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;[+] {}:{}&#39;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ip<span class="token punctuation">,</span> banner<span class="token punctuation">)</span><span class="token punctuation">)</span>
                checkVulns<span class="token punctuation">(</span>banner<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="抓取网络数据" tabindex="-1"><a class="header-anchor" href="#抓取网络数据" aria-hidden="true">#</a> 抓取网络数据</h2>`,3),r={href:"https://eqrthquake.usgs.gov/earthquakes/",target:"_blank",rel:"noopener noreferrer"},d=a(`<div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># 解析url</span>
<span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> urlparse
uc <span class="token operator">=</span> urlparse<span class="token punctuation">(</span><span class="token string">&quot;https://www.baidu.com&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>uc<span class="token punctuation">)</span> <span class="token comment"># ParseResult(scheme=&#39;https&#39;, netloc=&#39;www.baidu.com&#39;, path=&#39;&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)</span>

<span class="token comment"># 发送请求</span>
<span class="token keyword">import</span> requests
url <span class="token operator">=</span> <span class="token string">&#39;https://www.baidu.com&#39;</span>
<span class="token comment"># html = requests.get(url).text # 乱码，默认GBK解析？</span>
html <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># &lt;class &#39;str&#39;&gt;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token string">&quot;百度&quot;</span> <span class="token keyword">in</span> html<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;包含关键字“百度”&quot;</span><span class="token punctuation">)</span> <span class="token comment"># 打印</span>

<span class="token comment"># 正则表达式</span>
<span class="token keyword">import</span> requests<span class="token punctuation">,</span> re
regex <span class="token operator">=</span> <span class="token string">r&quot;([a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+)&quot;</span> <span class="token comment"># 邮箱</span>
emails <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>regex<span class="token punctuation">,</span> html<span class="token punctuation">)</span> <span class="token comment"># 获取返回内容中的所有邮箱</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),k={href:"https://www.crummy.com/software/BeautifulSoup/",target:"_blank",rel:"noopener noreferrer"},m=a(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>pip <span class="token function">install</span> beautifulsoup4
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">&#39;https://www.baidu.com&#39;</span>
html <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span>

<span class="token comment"># 解析网页标签</span>
sp <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">&#39;html.parser&#39;</span><span class="token punctuation">)</span>

<span class="token comment"># 获取所有链接</span>
links <span class="token operator">=</span> sp<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> l <span class="token keyword">in</span> links<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">,</span> l<span class="token punctuation">)</span>
<span class="token comment"># &lt;class &#39;bs4.element.Tag&#39;&gt; &lt;a class=&quot;mnav&quot; href=&quot;http://news.baidu.com&quot; name=&quot;tj_trnews&quot;&gt;新闻&lt;/a&gt;</span>
<span class="token comment"># &lt;class &#39;bs4.element.Tag&#39;&gt; &lt;a class=&quot;mnav&quot; href=&quot;https://www.hao123.com&quot; name=&quot;tj_trhao123&quot;&gt;hao123&lt;/a&gt;</span>
<span class="token comment"># &lt;class &#39;bs4.element.Tag&#39;&gt; &lt;a class=&quot;mnav&quot; href=&quot;http://map.baidu.com&quot; name=&quot;tj_trmap&quot;&gt;地图&lt;/a&gt;</span>
<span class="token comment"># &lt;class &#39;bs4.element.Tag&#39;&gt; &lt;a class=&quot;mnav&quot; href=&quot;http://v.baidu.com&quot; name=&quot;tj_trvideo&quot;&gt;视频&lt;/a&gt;</span>
<span class="token comment"># &lt;class &#39;bs4.element.Tag&#39;&gt; &lt;a class=&quot;mnav&quot; href=&quot;http://tieba.baidu.com&quot; name=&quot;tj_trtieba&quot;&gt;贴吧&lt;/a&gt;</span>
<span class="token comment"># &lt;class &#39;bs4.element.Tag&#39;&gt; &lt;a class=&quot;lb&quot; href=&quot;http://www.baidu.com/bdorz/login.gif?login&amp;amp;tpl=mn&amp;amp;u=http%3A%2F%2Fwww.baidu.com%2f%3fbdorz_come%3d1&quot; name=&quot;tj_login&quot;&gt;登录&lt;/a&gt;</span>
<span class="token comment"># &lt;class &#39;bs4.element.Tag&#39;&gt; &lt;a class=&quot;bri&quot; href=&quot;//www.baidu.com/more/&quot; name=&quot;tj_briicon&quot; style=&quot;display: block;&quot;&gt;更多产品&lt;/a&gt;</span>
<span class="token comment"># &lt;class &#39;bs4.element.Tag&#39;&gt; &lt;a href=&quot;http://home.baidu.com&quot;&gt;关于百度&lt;/a&gt;</span>
<span class="token comment"># &lt;class &#39;bs4.element.Tag&#39;&gt; &lt;a href=&quot;http://ir.baidu.com&quot;&gt;About Baidu&lt;/a&gt;</span>
<span class="token comment"># &lt;class &#39;bs4.element.Tag&#39;&gt; &lt;a href=&quot;http://www.baidu.com/duty/&quot;&gt;使用百度前必读&lt;/a&gt;</span>
<span class="token comment"># &lt;class &#39;bs4.element.Tag&#39;&gt; &lt;a class=&quot;cp-feedback&quot; href=&quot;http://jianyi.baidu.com/&quot;&gt;意见反馈&lt;/a&gt;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>links<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>contents<span class="token punctuation">)</span> <span class="token comment"># [&#39;新闻&#39;]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>links<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;href&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># http://news.baidu.com</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>DEMO: 拉取网站图片</p><details class="custom-container details"><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># _*_ coding: utf-8 _*_</span>

<span class="token keyword">from</span> functools <span class="token keyword">import</span> <span class="token builtin">reduce</span>
<span class="token keyword">import</span> pathlib
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> sys<span class="token punctuation">,</span> os
<span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> urlparse
<span class="token keyword">from</span> urllib<span class="token punctuation">.</span>request <span class="token keyword">import</span> urlopen

<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;请传入 url 参数&quot;</span><span class="token punctuation">)</span>
    exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

url <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
domain <span class="token operator">=</span> <span class="token string">&quot;{}://{}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>urlparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>scheme<span class="token punctuation">,</span> urlparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>hostname<span class="token punctuation">)</span>
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
r<span class="token punctuation">.</span>encoding <span class="token operator">=</span> r<span class="token punctuation">.</span>apparent_encoding <span class="token comment"># 网页编码</span>
html <span class="token operator">=</span> r<span class="token punctuation">.</span>text

sp <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">&#39;html.parser&#39;</span><span class="token punctuation">)</span>
all_links <span class="token operator">=</span> sp<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> link <span class="token keyword">in</span> all_links<span class="token punctuation">:</span>
    src <span class="token operator">=</span> link<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;src&#39;</span><span class="token punctuation">)</span>
    href <span class="token operator">=</span> link<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;href&#39;</span><span class="token punctuation">)</span>
    targets <span class="token operator">=</span> <span class="token punctuation">[</span>src<span class="token punctuation">,</span> href<span class="token punctuation">]</span>
    <span class="token keyword">for</span> t <span class="token keyword">in</span> targets<span class="token punctuation">:</span>
        <span class="token keyword">if</span> t <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> s<span class="token punctuation">,</span> i<span class="token punctuation">:</span> s <span class="token keyword">and</span> i <span class="token keyword">not</span> <span class="token keyword">in</span> t<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&#39;.jpg&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.png&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.gif&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        <span class="token keyword">if</span> t<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">&#39;http&#39;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            full_path <span class="token operator">=</span> t
        <span class="token keyword">elif</span> t<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">&#39;//&#39;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            full_path <span class="token operator">=</span> <span class="token string">&quot;https:&quot;</span> <span class="token operator">+</span> t
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            full_path <span class="token operator">=</span> domain <span class="token operator">+</span> t
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Downloading: &quot;</span> <span class="token operator">+</span> full_path<span class="token punctuation">)</span>
        image_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;target&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>image_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
            pathlib<span class="token punctuation">.</span>Path<span class="token punctuation">(</span>image_dir<span class="token punctuation">)</span><span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>parents<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        filename <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">lambda</span> s<span class="token punctuation">:</span> s<span class="token punctuation">.</span>path<span class="token punctuation">[</span>s<span class="token punctuation">.</span>path<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span>urlparse<span class="token punctuation">(</span>full_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
        image <span class="token operator">=</span> urlopen<span class="token punctuation">(</span>full_path<span class="token punctuation">)</span>
        fp <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>image_dir<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;wb&#39;</span><span class="token punctuation">)</span>
        fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>image<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        fp<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Downloaded: &quot;</span> <span class="token operator">+</span> full_path<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ xxxxxx<span class="token punctuation">\\</span>vuepress2-note<span class="token punctuation">\\</span>code<span class="token punctuation">\\</span>demo-python<span class="token punctuation">\\</span>network<span class="token punctuation">\\</span>download-image.py https://www.baidu.com 
Downloading: https://www.baidu.com/img/bd_logo1.png
Downloaded: https://www.baidu.com/img/bd_logo1.png
Downloading: http://www.baidu.com/bdorz/login.gif?login<span class="token operator">&amp;</span><span class="token assign-left variable">tpl</span><span class="token operator">=</span>mn<span class="token operator">&amp;</span><span class="token assign-left variable">u</span><span class="token operator">=</span>http%3A%2F%2Fwww.baidu.com%2f%3fbdorz_come%3d1
Downloaded: http://www.baidu.com/bdorz/login.gif?login<span class="token operator">&amp;</span><span class="token assign-left variable">tpl</span><span class="token operator">=</span>mn<span class="token operator">&amp;</span><span class="token assign-left variable">u</span><span class="token operator">=</span>http%3A%2F%2Fwww.baidu.com%2f%3fbdorz_come%3d1
Downloading: https://www.baidu.com/img/gs.gif
Downloaded: https://www.baidu.com/img/gs.gif

$ tree xxxxxx<span class="token punctuation">\\</span>vuepress2-note<span class="token punctuation">\\</span>code<span class="token punctuation">\\</span>demo-python<span class="token punctuation">\\</span>network<span class="token punctuation">\\</span>target 
target
 └── www.baidu.com
     ├── bd_logo1.png
     ├── gs.gif
     └── login.gif
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details></blockquote><p>检测页面内容是否更新</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> requests
<span class="token keyword">import</span> hashlib
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;http://target.web.site.page&#39;</span><span class="token punctuation">)</span>
sig <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigets<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="操作浏览器" tabindex="-1"><a class="header-anchor" href="#操作浏览器" aria-hidden="true">#</a> 操作浏览器</h2><p>request 只能获取 html。但是有的操作需要解析 html 并执行 js 脚本。</p><p>解决上述问题需要 selenium 模块，它可以直接操作系统中的浏览器，就好像人工在操作一样！</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>pip install selenium
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">提示</p><p>如果是 firefox 浏览器，可以下载 firebug 附加组件。它能帮我们更加方便地分析网页！</p></div><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
web <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Firefox<span class="token punctuation">(</span><span class="token punctuation">)</span>
web<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;https://www.sina.com.cn&#39;</span><span class="token punctuation">)</span>
web<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>webdriver 方法</th><th>说明</th></tr></thead><tbody><tr><td><code>get_window_position()</code></td><td>获取窗口位置（左上角）</td></tr><tr><td><code>set_window_position(x,y)</code></td><td>设置窗口位置（左上角）</td></tr><tr><td><code>maximize_window()</code></td><td></td></tr><tr><td><code>get_window_size()</code></td><td></td></tr><tr><td><code>set_window_size(x,y)</code></td><td></td></tr><tr><td><code>refresh()</code></td><td></td></tr><tr><td><code>back()</code></td><td>返回上一页</td></tr><tr><td><code>forward()</code></td><td>前往下一页</td></tr><tr><td><code>close()</code></td><td>关闭窗口</td></tr><tr><td><code>quit()</code></td><td>结束浏览器的执行</td></tr><tr><td><code>get(url)</code></td><td>浏览这个网页</td></tr><tr><td><code>save_screenshot(filename)</code></td><td>以 png 格式保存当前浏览器屏幕截图（存储完整的页面截图，不受窗口大小限制）</td></tr><tr><td><code>current_url</code></td><td></td></tr><tr><td><code>page_source</code></td><td></td></tr><tr><td><code>title</code></td><td></td></tr></tbody></table><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># _*_ coding: utf-8 _*_</span>
<span class="token comment"># 下载页面截图</span>

<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
urls <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;https://www.sina.com.cn&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;https://www.sohu.com&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;https://www.eastmoney.com&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;https://www.newone.com.cn&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;https://www.baidu.com&quot;</span>
<span class="token punctuation">]</span>
web <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Firefox<span class="token punctuation">(</span><span class="token punctuation">)</span>
web<span class="token punctuation">.</span>set_window_position<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
web<span class="token punctuation">.</span>set_window_size<span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span><span class="token number">600</span><span class="token punctuation">)</span> <span class="token comment"># 窗口大小不限制截图大小</span>
i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">:</span>
    web<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    web<span class="token punctuation">.</span>save_screenshot<span class="token punctuation">(</span><span class="token string">&quot;webpage{}.png&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
web<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>不需要 BeautifulSoup， Selenium 的 webdriver 本身就能检索页面的元素</p><table><thead><tr><th>webdirver 方法</th><th>说明</th></tr></thead><tbody><tr><td><code>find_element(by, value)</code></td><td>使用 by 方法查询第一个符合 value 的元素</td></tr><tr><td><code>find_element_by_class_name(name)</code></td><td></td></tr><tr><td><code>find_element_by_css_selector(selector)</code></td><td></td></tr><tr><td><code>find_element_by_id(id)</code></td><td></td></tr><tr><td><code>find_element_by_link_text(text)</code></td><td></td></tr><tr><td><code>find_element_by_name(name)</code></td><td></td></tr><tr><td><code>find_element_by_tag_name(name)</code></td><td></td></tr></tbody></table><p>对于找到的页面元素，有以下方法</p><table><thead><tr><th>页面元素方法</th><th>说明</th></tr></thead><tbody><tr><td><code>clear()</code></td><td>清除内容 content</td></tr><tr><td><code>click()</code></td><td></td></tr><tr><td><code>is_display()</code></td><td>是否可见状态</td></tr><tr><td><code>is_enabled()</code></td><td>是否可用状态</td></tr><tr><td><code>is_selected()</code></td><td>是否被选中的状态</td></tr><tr><td><code>send_keys(value)</code></td><td>对此元素送出一串字符，也可以是特定的按键</td></tr></tbody></table><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># _*_ coding: utf-8 _*_</span>
<span class="token comment"># 模拟登录</span>

<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver

web <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Firefox<span class="token punctuation">(</span><span class="token punctuation">)</span>
web<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;https://www.jd.com&quot;</span><span class="token punctuation">)</span>
web<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">&#39;ttbar-login&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
web<span class="token punctuation">.</span>find_element_by_name<span class="token punctuation">(</span><span class="token string">&#39;loginname&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
web<span class="token punctuation">.</span>find_element_by_name<span class="token punctuation">(</span><span class="token string">&#39;loginname&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">&#39;your account&#39;</span><span class="token punctuation">)</span>
web<span class="token punctuation">.</span>find_element_by_name<span class="token punctuation">(</span><span class="token string">&#39;nloginpwd&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
web<span class="token punctuation">.</span>find_element_by_name<span class="token punctuation">(</span><span class="token string">&#39;nloginpwd&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">&#39;you password&#39;</span><span class="token punctuation">)</span>
web<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">&#39;loginsubmit&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,18);function v(b,g){const t=o("ExternalLinkIcon");return c(),i("div",null,[u,s("p",null,[n("不管是半结构化数据（HTML）还是结构化数据（JSON、XML），通过解析网站提供的这些数据可以获取更多的信息。比如，通过 USGS 地震观测数据网站（"),s("a",r,[n("https://eqrthquake.usgs.gov/earthquakes/"),e(t)]),n("）可以以视觉的方式看到全球地震相关信息，同时也能以不同的格式提取这些数据。")]),d,s("p",null,[n("上面通过字符串匹配的方式提取到网页信息，但是不精确。需要精确解析网页内容就需要解析网页结构。 BeautifulSoup 是一款解析网页结构的项目产品。官网地址 "),s("a",k,[n("https://www.crummy.com/software/BeautifulSoup/"),e(t)]),n("。")]),m])}const h=p(l,[["render",v],["__file","python-network.html.vue"]]);export{h as default};
